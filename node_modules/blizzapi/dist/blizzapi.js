"use strict";var le=require("axios"),g=(e=>(e.REGIONS="REGIONS",e.LOCALES="LOCALES",e.DEFAULT_LOCALES="DEFAULT_LOCALES",e.REGION_API_HOSTS="REGION_API_HOSTS",e.SC2_REALMS="SC2_REALMS",e.OAUTH_AUTHORIZE_URIS="OAUTH_AUTHORIZE_URIS",e.OAUTH_TOKEN_URIS="OAUTH_TOKEN_URIS",e.OAUTH_CHECK_TOKEN_URIS="OAUTH_CHECK_TOKEN_URIS",e))(g||{}),R=(e=>(e.us="us",e.eu="eu",e.kr="kr",e.tw="tw",e.cn="cn",e))(R||{}),a=(e=>(e[e.us=1]="us",e[e.eu=2]="eu",e[e.kr=3]="kr",e[e.tw=3]="tw",e[e.cn=5]="cn",e))(a||{}),B=(e=>(e.us="1",e.eu="2",e.kr="3",e.tw="3",e.cn="5",e))(B||{}),h=(e=>(e.en_US="en_US",e.es_MX="es_MX",e.pt_BR="pt_BR",e.en_GB="en_GB",e.es_ES="es_ES",e.fr_FR="fr_FR",e.ru_RU="ru_RU",e.de_DE="de_DE",e.pt_PT="pt_PT",e.it_IT="it_IT",e.ko_KR="ko_KR",e.zh_TW="zh_TW",e.zh_CN="zh_CN",e))(h||{}),A=(e=>(e[e.us=0]="us",e[e.eu=0]="eu",e[e.kr=0]="kr",e[e.tw=0]="tw",e[e.cn=0]="cn",e))(A||{}),m=(e=>(e[e.US=1]="US",e[e.LatAm=2]="LatAm",e[e.Europe=1]="Europe",e[e.Russia=2]="Russia",e[e.Korea=1]="Korea",e[e.Taiwan=2]="Taiwan",e[e.China=1]="China",e))(m||{}),H=(e=>(e.US="1",e.LatAm="2",e.Europe="1",e.Russia="2",e.Korea="1",e.Taiwan="2",e.China="1",e))(H||{}),E=(e=>(e.GET="GET",e.POST="POST",e))(E||{}),k=(e=>(e.us="https://us.battle.net",e.eu="https://eu.battle.net",e.kr="https://apac.battle.net",e.tw="https://apac.battle.net",e.cn="https://www.battlenet.com.cn",e))(k||{}),O=(e=>(e.us="https://us.api.blizzard.com",e.eu="https://eu.api.blizzard.com",e.kr="https://kr.api.blizzard.com",e.tw="https://tw.api.blizzard.com",e.cn="https://gateway.battlenet.com.cn",e))(O||{}),T=(e=>(e.authorize="/oauth/authorize",e.token="/oauth/token",e.checkToken="/oauth/check_token?token=",e))(T||{}),b=(e=>(e.LastModified="last-modified",e))(b||{}),L=(e=>(e[e.NotAuthorized=401]="NotAuthorized",e))(L||{}),_=(e=>(e.InvalidToken="invalid_token",e.AccessTokenInvalid="access_token_invalid",e.AccessTokenExpired="access_token_invalid",e))(_||{});const ue=e=>e[0]==="/",de=e=>e.length>3,ge=[ue,de],he=e=>ge.every(t=>t(e)),Re=e=>/(?:http[s]?:\/\/)[^\s(["<,>]*\.[^\s[",><]*/gm.test(e),me=Object.freeze({[a.us]:A.us,[a.eu]:A.eu,[a.kr]:A.kr,[a.cn]:A.cn}),pe=Object.freeze({[a.us]:Object.freeze([h.en_US,h.es_MX,h.pt_BR]),[a.eu]:Object.freeze([h.en_GB,h.es_ES,h.fr_FR,h.ru_RU,h.de_DE,h.pt_PT,h.it_IT]),[a.kr]:Object.freeze([h.ko_KR,h.zh_TW]),[a.cn]:Object.freeze([h.zh_CN])}),Oe=Object.freeze({[a.us]:Object.freeze([R.us]),[a.eu]:Object.freeze([R.eu]),[a.kr]:Object.freeze([R.kr,R.tw]),[a.cn]:Object.freeze([R.cn])}),fe=Object.freeze({[a.us]:Object.freeze([m.US,m.LatAm]),[a.eu]:Object.freeze([m.Europe,m.Russia]),[a.kr]:Object.freeze([m.Korea,m.Taiwan]),[a.cn]:Object.freeze([m.China])}),Ae=Object.freeze({[a.us]:O.us,[a.eu]:O.eu,[a.kr]:[O.kr,O.tw],[a.cn]:O.cn}),y=Object.freeze({[a.us]:k.us,[a.eu]:k.eu,[a.kr]:k.kr,[a.cn]:k.cn}),j=e=>Object.freeze({[a.us]:`${y[a.us]}${e}`,[a.eu]:`${y[a.eu]}${e}`,[a.kr]:`${y[a.kr]}${e}`,[a.cn]:`${y[a.cn]}${e}`}),ke=j(T.authorize),ve=j(T.token),Se=j(T.checkToken),p={[g.REGIONS]:Oe,[g.LOCALES]:pe,[g.DEFAULT_LOCALES]:me,[g.SC2_REALMS]:fe,[g.REGION_API_HOSTS]:Ae,[g.OAUTH_AUTHORIZE_URIS]:ke,[g.OAUTH_TOKEN_URIS]:ve,[g.OAUTH_CHECK_TOKEN_URIS]:Se},f=p[g.REGIONS],Ee=()=>f,Te=()=>Object.keys(f).map(e=>parseInt(e,10)),_e=()=>{const e=Object.values(f);return[].concat(...e).map(t=>t.toString())},x=e=>{const t=Object.keys(f),n=e.toString();if(!t.includes(n))throw new RangeError(`${n} is not a valid parameter for getRegionNameById()`);return f[n]},v=e=>{try{return!!x(e)}catch{return!1}},C=e=>{const t=e.toLowerCase(),n=Object.keys(f).filter(s=>f[s].includes(t)),r=Number(n[0])||!1;if(!r)throw new RangeError(`"${e}" is not a valid parameter for getRegionIdByName()`);return r},F=e=>{try{return!!C(e)}catch{return!1}},N=(e,t)=>{const n=typeof e=="string"?e:e.toString();if(!v(n))throw new RangeError(`${n} is not a valid parameter for getConstantByRegionId(${e}, '${t}')`);return p[t][e]},Ie=(e,t)=>{if(!F(e))throw new RangeError(`${e} is not a valid parameter for getConstantByRegionName(${e}, '${t}')`);const n=C(e);return p[t][n]},U=(e,t)=>v(e)?N(e,t):Ie(e.toString(),t),be=p[g.LOCALES],K=()=>be,M=()=>Object.keys(h).filter(e=>Number.isNaN(Number(e))).map(e=>e.toString()),G=e=>N(e,g.LOCALES),D=e=>/^(?:[a-z]{2}_[a-z]{2})$/gi.test(e),V=e=>{if(!D(e))throw new RangeError(`${e} is not a valid parameter for validateLocale()`);const t=M().map(r=>r.toLowerCase()),n=e.toLowerCase();return t.includes(n)},ye=(e,t)=>{const n=e.toLowerCase(),r=V(n)||!1,s=t.toString(),u=v(s);if(!r)throw new RangeError(`${e} is not a valid locale parameter for isLocaleValidForRegionId()`);if(!u)throw new RangeError(`${t} is not a valid regionId parameter for isLocaleValidForRegionId()`);return G(t).map(i=>i.toLowerCase()).includes(n)},we=p[g.DEFAULT_LOCALES],Le=p[g.LOCALES],q=e=>{const t=e.toString();if(!v(t))throw new RangeError(`${t} is not a valid parameter for getDefaultLocaleNameForRegionId()`);const n=we[t];return Le[e][n]},je=()=>{const e=K(),t=Object.keys(e);return Object.assign({},...t.map(n=>({[n]:q(n)})))},Ce=()=>p.SC2_REALMS,Q=()=>{const e=Object.values(p.SC2_REALMS);return[].concat(...e).filter((t,n,r)=>n===r.indexOf(t))},W=e=>N(e,g.SC2_REALMS),z=e=>{const t=e.toString();return/^([1-9]{1})$/gi.test(t)},Ne=e=>{if(!z(e))throw new RangeError(`${e} is not a valid parameter for validateSc2Realm()`);const t=Q(),n=typeof e=="number"?e:parseInt(e,10);return t.includes(n)},Ue=(e,t)=>{const n=z(e),r=t.toString(),s=v(r);if(!n)throw new RangeError(`${e} is not a valid sc2Realm parameter for isSc2RealmValidForRegionId()`);if(!s)throw new RangeError(`${t} is not a valid regionId parameter for isSc2RealmValidForRegionId()`);const u=W(t),i=typeof e=="number"?e:parseInt(e,10);return u.includes(i)},ze=e=>{const t=U(e,g.REGION_API_HOSTS);return typeof e=="string"&&e.toLowerCase()===R.kr?t[0]:typeof e=="string"&&e.toLowerCase()===R.tw?t[1]:t},$e=e=>U(e,g.OAUTH_CHECK_TOKEN_URIS),Pe=e=>U(e,g.OAUTH_TOKEN_URIS);var Be=Object.defineProperty,X=Object.getOwnPropertySymbols,He=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable,Z=(e,t,n)=>t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,S=(e,t)=>{for(var n in t||(t={}))He.call(t,n)&&Z(e,n,t[n]);if(X)for(var n of X(t))xe.call(t,n)&&Z(e,n,t[n]);return e},Fe=(e,t,n)=>new Promise((r,s)=>{var u=o=>{try{c(n.next(o))}catch(l){s(l)}},i=o=>{try{c(n.throw(o))}catch(l){s(l)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(u,i);c((n=n.apply(e,t)).next())});const $=e=>Fe(void 0,null,function*(){const{uri:t,timeout:n,headers:r,params:s,data:u,auth:i}=e,c=e.method||E.GET;if(!Re(t))throw new RangeError(`'${t}' is not a valid parameter for fetchFromUri()`);const o=S(S(S(S({method:c,url:encodeURI(t),timeout:n||1e4},r&&{headers:r}),s&&{params:s}),i&&{auth:i}),u&&{data:u}),l=yield le.request(o),I=l.headers[b.LastModified]?l.headers[b.LastModified]:null;return S(S({},l.data),I&&{lastModified:I})}),J=e=>{const{region:t,clientId:n,clientSecret:r}=e;if(!n)throw new Error("Cannot get access token because no Battle.net client id was provided");if(!r)throw new Error("Cannot get access token because no Battle.net client secret was provided");const s="grant_type=client_credentials",u={username:n,password:r},i=Pe(t);return $({data:s,auth:u,uri:i,method:E.POST})};var Ke=(e,t,n)=>new Promise((r,s)=>{var u=o=>{try{c(n.next(o))}catch(l){s(l)}},i=o=>{try{c(n.throw(o))}catch(l){s(l)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(u,i);c((n=n.apply(e,t)).next())});const Y=(e,t)=>Ke(void 0,null,function*(){try{const n=`${$e(e)}${t}`;return(yield $({uri:n})).error!==_.InvalidToken}catch{return!1}});var Me=Object.defineProperty,ee=Object.getOwnPropertySymbols,Ge=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable,te=(e,t,n)=>t in e?Me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,w=(e,t)=>{for(var n in t||(t={}))Ge.call(t,n)&&te(e,n,t[n]);if(ee)for(var n of ee(t))De.call(t,n)&&te(e,n,t[n]);return e},ne=(e,t,n)=>new Promise((r,s)=>{var u=o=>{try{c(n.next(o))}catch(l){s(l)}},i=o=>{try{c(n.throw(o))}catch(l){s(l)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(u,i);c((n=n.apply(e,t)).next())});const oe=(e,t)=>{const{region:n,endpoint:r,options:s}=e,{headers:u,params:i,timeout:c}=s;if(!he(r))throw new RangeError(`${r} is not a valid endpoint.`);const o=`${ze(n)}${r}`,l={Authorization:`Bearer ${t}`},I=w(w({},u),l);return $(w(w({uri:o,method:E.GET,headers:I},i&&{params:i}),c&&{timeout:c}))},re=e=>ne(void 0,null,function*(){const{onAccessTokenRefresh:t}=e.options,n=(yield J(e)).access_token;return t?.(n),oe(e,n)}),Ve=e=>ne(void 0,null,function*(){var t;const{region:n,accessToken:r}=e,{validateAccessTokenOnEachQuery:s,refreshExpiredAccessToken:u,onAccessTokenExpired:i}=e.options;if(s&&!(yield Y(n,r)))return i?.(),u?re(e):{error:_.AccessTokenInvalid};try{return yield oe(e,r)}catch(c){if(((t=c.response)==null?void 0:t.status)===L.NotAuthorized)return i?.(),u?re(e):Promise.resolve({error:_.AccessTokenExpired});throw c}});class qe{constructor(t,n){this.clientId=t,this.clientSecret=n}}var P=(e,t,n)=>new Promise((r,s)=>{var u=o=>{try{c(n.next(o))}catch(l){s(l)}},i=o=>{try{c(n.throw(o))}catch(l){s(l)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(u,i);c((n=n.apply(e,t)).next())});class ae extends qe{constructor(t){super(t.clientId,t.clientSecret),this.getAccessToken=()=>P(this,null,function*(){return(yield this.getAccessTokenObject()).access_token}),this.getAccessTokenObject=()=>this.accessTokenObject?Promise.resolve(this.accessTokenObject):this.setAccessTokenObject(),this.getAccessTokenObjectFromBnet=()=>P(this,null,function*(){return J({region:this.region,clientId:this.clientId,clientSecret:this.clientSecret})}),this.region=t.region,this.accessTokenObject=t.accessToken?{access_token:t.accessToken}:void 0}setAccessToken(){return this.setAccessTokenObject()}setAccessTokenObject(){return P(this,null,function*(){return this.accessTokenObject=yield this.getAccessTokenObjectFromBnet(),this.accessTokenObject})}}ae.validateAccessToken=(e,t)=>Y(e,t);var Qe=Object.defineProperty,se=Object.getOwnPropertySymbols,We=Object.prototype.hasOwnProperty,Xe=Object.prototype.propertyIsEnumerable,ce=(e,t,n)=>t in e?Qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ie=(e,t)=>{for(var n in t||(t={}))We.call(t,n)&&ce(e,n,t[n]);if(se)for(var n of se(t))Xe.call(t,n)&&ce(e,n,t[n]);return e},Ze=(e,t,n)=>new Promise((r,s)=>{var u=o=>{try{c(n.next(o))}catch(l){s(l)}},i=o=>{try{c(n.throw(o))}catch(l){s(l)}},c=o=>o.done?r(o.value):Promise.resolve(o.value).then(u,i);c((n=n.apply(e,t)).next())});class d extends ae{constructor(t){super({region:t.region,clientId:t.clientId,clientSecret:t.clientSecret,accessToken:t.accessToken}),this.query=(n,r)=>Ze(this,null,function*(){return Ve({endpoint:n,region:r?.region||this.region,clientId:this.clientId,clientSecret:this.clientSecret,accessToken:yield this.getAccessToken(),options:ie(ie({},this.options),r)})}),this.options={validateAccessTokenOnEachQuery:t.validateAccessTokenOnEachQuery||!1,refreshExpiredAccessToken:t.refreshExpiredAccessToken||!1,onAccessTokenExpired:t.onAccessTokenExpired||void 0,onAccessTokenRefresh:t.onAccessTokenRefresh||void 0}}setRegion(t){this.region=t}}d.getAllRegions=Ee,d.getAllRegionIds=Te,d.getAllRegionNames=_e,d.getRegionNameById=x,d.validateRegionId=v,d.getRegionIdByName=C,d.validateRegionName=F,d.getAllLocales=K,d.getAllLocaleNames=M,d.getLocalesByRegionId=G,d.checkIfLocaleLooksValid=D,d.validateLocale=V,d.isLocaleValidForRegionId=ye,d.getAllSc2Realms=Ce,d.getAllAvailableSc2Realms=Q,d.getSc2RealmsByRegionId=W,d.checkIfSc2RealmLooksValid=z,d.validateSc2Realm=Ne,d.isSc2RealmValidForRegionId=Ue,d.getDefaultLocaleNameForRegionId=q,d.getAllDefaultLocaleNames=je,exports.ApiHeaders=b,exports.BlizzAPI=d,exports.ConstantKey=g,exports.DefaultLocaleIndex=A,exports.ErrorCode=L,exports.ErrorResponseMessage=_,exports.HttpMethod=E,exports.Locale=h,exports.OAuthEndpoint=T,exports.OAuthHost=k,exports.RegionHost=O,exports.RegionIdAsStringEnum=B,exports.RegionIdEnum=a,exports.RegionNameEnum=R,exports.Sc2Realm=m,exports.Sc2RealmAsString=H;
